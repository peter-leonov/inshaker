<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru">
<head>
	<title>DataFilter test</title>
</head>
<body>
<script>
	
	// условия, на которые опирается этот алгоритм:
	//  литр из большей тары дешевле литра из меньшей
	//  массивы отсортированы по объему
	//  лучше купить больше за те же деньги
	
	function onload ()
	{
		console.time('count')
		var answer = count(117.2, [2, 1, 0.5, 0.33, 0.25, 0.15], [52,  38, 32, 30, 35, 30])
		console.timeEnd('count')
		console.info(answer)
		
		console.time('count')
		var answer = count(117.2, [0.5, 0.33], [32, 30])
		console.timeEnd('count')
		console.info(answer)
		
		console.time('count')
		var answer = count(1.5, [1, 0.75, 0.5], [20, 14, 10])
		console.timeEnd('count')
		console.info(answer)
	}
	
	function count (max_vol, vols, costs)
	{
		var vol_index = 0
		var vols_length = vols.length
		var biggest = vols[0]
		
		// calculating long tail
		var tail = max_vol % (biggest * 2)
		var big_bottles_count = (max_vol - tail) / biggest
		
		var stack = []
		var min = Infinity
		var the_one = null
		
		function walk (summ_vol, summ_cost, vols_length, vols, costs)
		{
			for (var i = 0; i < vols_length; i++)
			{
				var cost = costs[i]
				var vol = vols[i]
				
				var now_cost = summ_cost + cost
				var now_vol = summ_vol + vol
				
				if (now_cost >= min)
					continue
				
				stack[stack.length] = vol
				if (now_vol >= tail)
				{
					min = now_cost
					the_one = stack.slice()
					// console.info(now_vol, now_cost, stack.slice())
				}
				else
					walk(now_vol, now_cost, vols_length, vols, costs)
				stack.length--
			}
		}
		
		walk(0, 0, vols_length, vols, costs)
		
		var answer = {}
		for (var i = 0; i < the_one.length; i++)
			if (answer[the_one[i]])
				answer[the_one[i]]++
			else
				answer[the_one[i]] = 1
		
		if (big_bottles_count)
		{
			if (answer[biggest])
				answer[biggest] += big_bottles_count
			else
				answer[biggest] = big_bottles_count
		}
		
		return answer
	}
</script>
</body>
</html>