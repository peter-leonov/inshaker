<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=device-width"/>
	<title>Tests for findCheapestPrice()</title>
	<script src="tests.common.js" type="text/javascript"></script>
	
	<script type="text/javascript" src="/lib-0.3/core/prototype.js"></script>
	<script type="text/javascript" src="/js/common/find-cheapest-price.js"></script>
</head>
<body>
<script type="text/javascript">
Tests.test(function (t)
{
	t.ok(findCheapestPrice, 'findCheapestPrice')
	
	function f (volumes, max)
	{
		if (!volumes.length)
			return {}
		
		if (max <= 0)
			return {}
		
		var res = findCheapestPrice({volumes: volumes}, max)
		
		var h = {}
		
		if (res.addingBottles.amount)
			h[res.addingBottles.vol] = res.addingBottles.amount
		
		for (var i = 0; i < res.bottles.length; i++)
		{
			var v = res.bottles[i][0]
			if (h[v])
				h[v]++
			else
				h[v] = 1
		}
		
		return h
	}
	
	t.test('real life examples', function (t)
	{
		t.test('Bacardi Superior', function (t)
		{
			var volumes = [[0.5, 641], [0.75, 991]]
			t.log(volumes)
			
			t.like(f(volumes, 0.4), {0.5: 1}, '0.4')
			t.like(f(volumes, 0.5), {0.5: 1}, '0.5')
			t.like(f(volumes, 0.51), {0.75: 1}, '0.51')
			t.like(f(volumes, 0.75), {0.75: 1}, '0.75')
			t.like(f(volumes, 0.76), {0.5: 2}, '0.76')
			t.like(f(volumes, 1.0), {0.5: 2}, '1.0')
			t.like(f(volumes, 1.5), {0.5: 3}, '1.5')
			t.like(f(volumes, 1.75), {0.5: 2, 0.75: 1}, '1.75')
			t.like(f(volumes, 2.25), {0.5: 3, 0.75: 1}, '2.25')
			t.like(f(volumes, 3.0), {0.5: 6}, '3.0')
			t.like(f(volumes, 37.5), {0.5: 75}, '37.5')
		})
		
		t.test('Coca-cola from dostavka.7cont.ru', function (t)
		{
			var volumes = [[0.5, 37.90], [1.0, 52.90], [2.0, 56.90]]
			t.log(volumes)
			
			t.like(f(volumes, 0.5), {0.5: 1}, '0.5')
			t.like(f(volumes, 1.0), {1.0: 1}, '1.0')
			t.like(f(volumes, 1.25), {2.0: 1}, '1.25')
			t.like(f(volumes, 1.5), {2.0: 1}, '1.25')
			t.like(f(volumes, 2.0), {2.0: 1}, '2.0')
			t.like(f(volumes, 2.5), {2.0: 1, 0.5: 1}, '2.5')
			t.like(f(volumes, 2.51), {2.0: 1, 1.0: 1}, '2.51')
			t.like(f(volumes, 3.0), {1.0: 1, 2.0: 1}, '3.0')
			t.like(f(volumes, 3.1), {2.0: 2}, '3.1')
			t.like(f(volumes, 100), {2.0: 50}, '100')
			t.like(f(volumes, 100.5), {2.0: 50, 0.5: 1}, '100.5')
		})
	})
	
	t.test('corner cases', function (t)
	{
		t.like(f([], 10), {}, 'empty volumes')
		t.like(f([[0.25, 50]], 0), {}, 'zero volume')
		t.like(f([[0.25, 50]], -1), {}, 'negative volume')
	})
})
</script>
</body>
</html>