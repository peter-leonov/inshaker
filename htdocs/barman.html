<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru">
<head>
	<title>InShaker — Barman</title>
	<style>
		html { font-family: Arial,sans-serif; }
		img { display:block; }
		
		.rounded-top {
			-moz-border-radius-topleft: 10px;
			-moz-border-radius-topright: 10px;
			-webkit-border-top-left-radius: 10px;
			-webkit-border-top-right-radius: 10px;
		}
		
		body {
			display:block;
			width: 768px;
			margin: 20px auto;
		}
		
		.wrapper {
			width: 450px;
			height: 180px;
			border: 1px #E0E0E0 solid;
			margin: 20px auto;
			padding: 20px;
		}
		
		.name {
			font-size: 18px;
			margin-bottom: 20px;
		}
		
		.logo {
			float:left;
		}
		
		a {
			color:#cc2f7c;
		}
		
		a.purple {
			color:#4e4799;
		}
		
		.go {
			cursor: pointer;
			background:#cc2f7c;
			-moz-border-radius: 10px;
			-webkit-border-radius: 10px;
			width: 100px;
			line-height: 40px;
			height: 40px;
			float: right;
			color: #FFFFFF;
			text-align:center;
			margin-top: 50px;
		}
		
		.go-purple {
			cursor: pointer;
			background: #4e4799;
			-moz-border-radius: 10px;
			-webkit-border-radius: 10px;
			width: 100px;
			line-height: 40px;
			height: 40px;
			float: right;
			color: #FFFFFF;
			text-align:center;
			margin-top: 50px;
		}
		
		.clicked {
			cursor:default;
			background: #E0E0E0;
			color: #C0C0C0;
			border: 1px #C0C0C0 solid;
		}
		
		.options {
			float: left;
			width: 195px;
			margin-left: 25px;
			font-size: 16px;
		}
		
		#output {
			width: 503px;
			visibility: hidden;
			font-size: 12px;
			margin: 20px 115px;
			background: #EDEDED;
			border: 1px #C0C0C0 solid;
			height: 0px;
			overflow: auto;
			padding: 15px;
		}
		
		#left, #right {
			position: absolute; 
			top: 120px;
			-moz-border-radius: 5px;
			-webkit-border-radius: 5px;
			padding: 5px;
			border: 1px #c0c0c0 solid;
			color: #979797;
			width: 80px;
			text-align: center;
		}
				
		#left:hover, #right:hover {
			color: #000000;
			border: 1px #000000 solid;
			cursor: pointer;
		}
		
		
		#right {
			margin-left: 673px;
		}
		
		div.disabled {
			display:none;
		}
		
		#ri .viewport {
			margin-left: 115px;
			width: 535px;
			height: 242px;
			overflow: hidden;
			position: relative;
		}
		
		#ri .surface {
			width: 4000px;
		}
		
		#ri .point {
			float: left;
			width: 493px;
			height: 180px;
		}
		
		form label {
			display: block;
			padding: 1px 0;
		}
		form label input {
			vertical-align: bottom;
			margin: 3px;
		}
	</style>
</head>
<body id="barman-page">
	<div class="programica-rolling-images" id="ri">
		<div class="prev" id="left"></div>
		<div class="next" id="right"></div>
	
		<div class="viewport">
			<div class="surface">
				<div class="wrapper rounded-top point" id="point_0">
					<div class="name">Код на <a href="http://inshaker.barman.programica.ru" target="_blank" class="purple">inshaker.barman.programica.ru</a></div>
					<img class="logo" src="/i/logo/strip.png"></img>
					<div class="options">Обновление кода на тестовом сервере из subversion.
					</div>
					<div id="goSVN" class="go-purple"></div>
				</div>
				<div class="wrapper rounded-top point" id="point_1">
					<div class="name">Обновление <a href="http://inshaker.barman.programica.ru" target="_blank">inshaker.barman.programica.ru</a></div>
					<img class="logo" src="/i/logo/barman.png"/>
					<div class="options">
						<form action="#" method="post" id='barman_form'>
							<label><input type="checkbox" name="cocktails"/>Коктейли</label>
							<label><input type="checkbox" name="ingredients"/>Ингредиенты</label>
							<label><input type="checkbox" name="tools"/>Штучки</label>
							<label><input type="checkbox" name="bars"/>Бары</label>
							<label><input type="checkbox" name="events"/>События</label>
							<label><input type="checkbox" name="parties"/>Вечеринки</label>
						</form>
					</div>
					<div id="goBarman" class="go"></div>
				</div>
				<div class="wrapper rounded-top point" id="point_2">
					<div class="name">Обновление сайта <a href="http://www.inshaker.ru" target="_blank">www.inshaker.ru</a></div>
					<img class="logo" src="/i/logo/barman.png"></img>
					<div class="options">...включая код, изображения и данные.
					</div>
					<div id="goUp" class="go"></div>
				</div>
			</div>
		</div>
	</div>
	<pre id="output">
	</pre>
</body>
</html>

<script type="text/javascript">
<!--# include file="/js/common/programica.js" -->
<!--# include file="/js/common/util.js" -->
<!--# include file="/lib/Programica/Request.js" -->
<!--# include file="/lib/Programica/Form.js" -->

$.onload(function(){
	var ri = new Programica.RollingImagesLite($('ri'), {animationType: 'directJump'});
	
	var inflateNode = function(node){ 
		node.style.visibility="visible"; 
		var ht = (node.scrollHeight > 300) ? 300 : node.scrollHeight;
		node.animate("easeInCubic", {height: ht}, 0.15) 
	};
	var squeezeNode = function(node){ 
		node.animate("easeInCubic", {height: 0}, 0.15);
		node.style.visibility="hidden";
	};
	
	var labels = ["Код", "Бармен", "Сайт"];
	ri.onselect = function(node, num){
		if(labels[num-1]) $('left').innerHTML  = "← " + labels[num-1];
		if(labels[num+1]) $('right').innerHTML = labels[num+1] + " →";
		squeezeNode($('output'))
	}
	
	var memory = Object.parse(Cookie.get('barman-memory'));
	if (memory){
		var inputs = $('barman_form').getElementsByTagName('input')
		for (var i = 0; i < inputs.length; i++){
				inputs[i].checked = memory[inputs[i].name] ? 'checked' : ''
		}
	}
	
	var UIButton = function(id, disabledStyle, enabledText, disabledText, clickListener){
		this.e = $(id);
		
		this.setEnabled = function(enabled){
			this.enabled = enabled;
			if(!enabled) {
				this.e.innerHTML = disabledText;
				this.e.addClassName(disabledStyle);
				this.e.removeEventListener('click', clickListener, false);
			} else {
				this.e.innerHTML = enabledText;
				this.e.remClassName(disabledStyle);
				this.e.addEventListener('click', clickListener, false);
			}
		};
		this.setEnabled(true);
	}
	
	var goBarmanButton = new UIButton('goBarman', 'clicked', 'Смешать', 'Подожди...', function(e){
		var fh = $('barman_form').toHash();
		Cookie.set('barman-memory', Object.stringify(fh));
		
		goBarmanButton.setEnabled(false);
		squeezeNode($('output'));
		
		var req = aPost("/act/launcher.cgi", fh);
		req.onSuccess = function (){
			$('output').innerHTML = this.responseText();
			inflateNode($('output'));
			goBarmanButton.setEnabled(true);
		}
	});
	
	var goSVNButton = new UIButton('goSVN', 'clicked', 'Скачать', 'Подожди...', function(e){
		goSVNButton.setEnabled(false);
		
		squeezeNode($('output'));
		var req = aPost("/act/svnup.cgi", {});
		req.onSuccess = function (){
			$('output').innerHTML = this.responseText();
			inflateNode($('output'));
			goSVNButton.setEnabled(true);
		}
	});
	
	var goUpButton = new UIButton('goUp', 'clicked', 'Обновить', 'Подожди...', function(e){
		goUpButton.setEnabled(false);
		
		squeezeNode($('output'));
		var req = aPost("/act/deployer.cgi", {});
		req.onSuccess = function (){
			$('output').innerHTML = this.responseText();
			inflateNode($('output'));
			goUpButton.setEnabled(true);
		}
	});
	
	ri.goToFrame(1); ri.onselect($('point_1'), 1);
})
</script>